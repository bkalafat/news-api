services:
  # Backend API Service
  - type: web
    name: newsportal-backend
    env: docker
    dockerfilePath: ./Dockerfile
    dockerContext: .
    region: frankfurt  # EU region (Türkiye'ye yakın)
    plan: free
    branch: master
    healthCheckPath: /health
    autoDeploy: true
    
    envVars:
      # ASP.NET Core
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ASPNETCORE_URLS
        value: http://+:8080
      
      # MongoDB
      - key: MongoDbSettings__ConnectionString
        value: mongodb+srv://bkalafat:dbuserpassword123@cluster0.xwbfl1o.mongodb.net/NewsDb?retryWrites=true&w=majority
      - key: MongoDbSettings__DatabaseName
        value: NewsDb
      - key: MongoDbSettings__NewsCollectionName
        value: News
      
      # JWT
      - key: JwtSettings__SecretKey
        generateValue: true  # Otomatik güvenli key üretir
      - key: JwtSettings__Issuer
        value: NewsPortalAPI
      - key: JwtSettings__Audience
        value: NewsPortalClients
      - key: JwtSettings__ExpirationMinutes
        value: 60
      
      # Cloudflare R2 (MinIO yerine)
      - key: MinioSettings__Endpoint
        value: 7ac015923324a4d426c1f7782c3f41e1.r2.cloudflarestorage.com
      - key: MinioSettings__AccessKey
        value: cc61a30e775100a198836d97dbce0d79
      - key: MinioSettings__SecretKey
        sync: false  # Render dashboard'dan eklenecek
      - key: MinioSettings__BucketName
        value: news-images
      - key: MinioSettings__UseSSL
        value: "true"
      
      # CORS
      - key: AllowedOrigins
        value: https://newsportal-frontend.vercel.app,https://newsportal.com
      
      # Logging
      - key: Logging__LogLevel__Default
        value: Information
      - key: Logging__LogLevel__Microsoft.AspNetCore
        value: Warning

  # Background Worker - News Aggregator (Cron Job)
  # NOT: Bu Render'ın ücretli özelliği, GitHub Actions kullanacağız
  # Aşağıdaki kısım referans için, aktif değil
  
  # - type: cron
  #   name: news-aggregator-cron
  #   env: python
  #   runtime: python
  #   buildCommand: pip install -r scripts/requirements.txt
  #   schedule: "0 2 * * *"  # Her gün 02:00 UTC (TR 05:00)
  #   startCommand: python scripts/news_aggregator.py --once
  #   
  #   envVars:
  #     - key: API_BASE_URL
  #       value: https://newsportal-backend.onrender.com/api
  #     - key: ADMIN_USERNAME
  #       sync: false
  #     - key: ADMIN_PASSWORD
  #       sync: false
  #     - key: UNSPLASH_ACCESS_KEY
  #       sync: false

# Database - Render PostgreSQL (MongoDB için kullanılmayacak, MongoDB Atlas kullanacağız)
# Bu kısım sadece referans için

# Notlar:
# 1. MongoDB Atlas'tan connection string al ve Render dashboard'da environment variable olarak ekle
# 2. Cloudflare R2 credentials'ları Render dashboard'da ekle
# 3. Admin credentials (username/password) güvenli şekilde sakla
# 4. GitHub Actions ile cron job'ı yönet (ücretsiz ve daha güvenilir)
